{% extends "base.html" %}

{% block title %}Magellan EV - Settings{% endblock %}

{% block content %}
    <div class="navbar">
        <div class="d-flex justify-content-between align-items-center w-100">
            <h2>Settings</h2>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="card bg-dark text-light mb-4">
                <div class="card-header">
                    <h4>Dashboard Visualization Settings</h4>
                </div>
                <div class="card-body">
                    <form id="dashboardSettingsForm" method="POST" action="{{ url_for('main.save_dashboard_settings') }}">
                        <div class="mb-3">
                            <h5>Select which charts to display on the dashboard:</h5>
                            <div class="form-check form-switch mb-2">
                                <input class="form-check-input" type="checkbox" id="showOverallProgress" name="dashboard_charts" value="overall_progress" checked>
                                <label class="form-check-label" for="showOverallProgress">Overall Progress Circle</label>
                            </div>
                            <div class="form-check form-switch mb-2">
                                <input class="form-check-input" type="checkbox" id="showQuantityDistribution" name="dashboard_charts" value="quantity_distribution" checked>
                                <label class="form-check-label" for="showQuantityDistribution">Quantity Distribution</label>
                            </div>
                            <div class="form-check form-switch mb-2">
                                <input class="form-check-input" type="checkbox" id="showProgressHistogram" name="dashboard_charts" value="progress_histogram" checked>
                                <label class="form-check-label" for="showProgressHistogram">Progress Histogram</label>
                            </div>
                            <div class="form-check form-switch mb-2">
                                <input class="form-check-input" type="checkbox" id="showSchedulePerformance" name="dashboard_charts" value="schedule_performance" checked>
                                <label class="form-check-label" for="showSchedulePerformance">Schedule Performance Index</label>
                            </div>
                            <div class="form-check form-switch mb-2">
                                <input class="form-check-input" type="checkbox" id="showManpowerDistribution" name="dashboard_charts" value="manpower_distribution" checked>
                                <label class="form-check-label" for="showManpowerDistribution">Manpower Distribution</label>
                            </div>
                            <div class="form-check form-switch mb-2">
                                <input class="form-check-input" type="checkbox" id="showBudgetByPhase" name="dashboard_charts" value="budget_by_phase" checked>
                                <label class="form-check-label" for="showBudgetByPhase">Budget by Phase</label>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <h5>Planned % Complete Settings:</h5>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="radio" name="planned_complete_interval" id="intervalDaily" value="daily" checked>
                                <label class="form-check-label" for="intervalDaily">
                                    Daily Intervals
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="radio" name="planned_complete_interval" id="intervalWeekly" value="weekly">
                                <label class="form-check-label" for="intervalWeekly">
                                    Weekly Intervals
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="radio" name="planned_complete_interval" id="intervalMonthly" value="monthly">
                                <label class="form-check-label" for="intervalMonthly">
                                    Monthly Intervals
                                </label>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Save Settings</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Load saved settings if available
        const savedSettings = localStorage.getItem('dashboardSettings');
        if (savedSettings) {
            const settings = JSON.parse(savedSettings);
            
            // Set chart visibility checkboxes
            if (settings.charts) {
                document.querySelectorAll('input[name="dashboard_charts"]').forEach(checkbox => {
                    checkbox.checked = settings.charts.includes(checkbox.value);
                });
            }
            
            // Set planned complete interval
            if (settings.plannedCompleteInterval) {
                document.querySelector(`input[name="planned_complete_interval"][value="${settings.plannedCompleteInterval}"]`).checked = true;
            }
        }
        
        // Handle form submission
        document.getElementById('dashboardSettingsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Collect selected charts
            const selectedCharts = [];
            document.querySelectorAll('input[name="dashboard_charts"]:checked').forEach(checkbox => {
                selectedCharts.push(checkbox.value);
            });
            
            // Get selected interval
            const selectedInterval = document.querySelector('input[name="planned_complete_interval"]:checked').value;
            
            // Save settings to localStorage
            const settings = {
                charts: selectedCharts,
                plannedCompleteInterval: selectedInterval
            };
            
            localStorage.setItem('dashboardSettings', JSON.stringify(settings));
            
            // Show success message
            alert('Settings saved successfully!');
            
            // Redirect to dashboard
            window.location.href = "{{ url_for('main.index') }}";
        });
    });
</script>
{% endblock %}
