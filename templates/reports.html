{% extends "base.html" %}

{% block title %}Reports - Magellan EV Tracker{% endblock %}

{% block content %}
    <div class="navbar">
        <div class="d-flex justify-content-between align-items-center w-100">
            <h2>Reports</h2>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6 mb-4">
            <div class="card h-100">
                <div class="card-header">
                    <h3>Hours Report</h3>
                </div>
                <div class="card-body">
                    <p>Generate a report showing earned hours vs. budgeted hours for projects, sub jobs, or work items.</p>
                    
                    <form action="{{ url_for('main.generate_hours_report') }}" method="GET" target="_blank">
                        <div class="mb-3">
                            <label class="form-label">Project</label>
                            <select class="form-select" name="project_id" id="hoursProjectSelect" required>
                                <option value="">Select Project</option>
                                {% for project in projects %}
                                    <option value="{{ project.id }}">{{ project.project_id_str }}: {{ project.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Sub Job</label>
                            <select class="form-select" name="sub_job_id" id="hoursSubJobSelect" disabled>
                                <option value="">All Sub Jobs</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Report Level</label>
                            <select class="form-select" name="level" required>
                                <option value="project">Project Level</option>
                                <option value="sub_job">Sub Job Level</option>
                                <option value="work_item">Work Item Level</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Format</label>
                            <div class="d-flex">
                                <div class="form-check me-4">
                                    <input class="form-check-input" type="radio" name="format" id="hoursPdfFormat" value="pdf" checked>
                                    <label class="form-check-label" for="hoursPdfFormat">
                                        PDF
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="format" id="hoursExcelFormat" value="excel">
                                    <label class="form-check-label" for="hoursExcelFormat">
                                        Excel
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-file-download"></i> Generate Report
                        </button>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="col-md-6 mb-4">
            <div class="card h-100">
                <div class="card-header">
                    <h3>Quantities Report</h3>
                </div>
                <div class="card-body">
                    <p>Generate a report showing earned quantities vs. budgeted quantities for projects, sub jobs, or work items.</p>
                    
                    <form action="{{ url_for('main.generate_quantities_report') }}" method="GET" target="_blank">
                        <div class="mb-3">
                            <label class="form-label">Project</label>
                            <select class="form-select" name="project_id" id="quantitiesProjectSelect" required>
                                <option value="">Select Project</option>
                                {% for project in projects %}
                                    <option value="{{ project.id }}">{{ project.project_id_str }}: {{ project.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Sub Job</label>
                            <select class="form-select" name="sub_job_id" id="quantitiesSubJobSelect" disabled>
                                <option value="">All Sub Jobs</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Report Level</label>
                            <select class="form-select" name="level" required>
                                <option value="project">Project Level</option>
                                <option value="sub_job">Sub Job Level</option>
                                <option value="work_item">Work Item Level</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Format</label>
                            <div class="d-flex">
                                <div class="form-check me-4">
                                    <input class="form-check-input" type="radio" name="format" id="quantitiesPdfFormat" value="pdf" checked>
                                    <label class="form-check-label" for="quantitiesPdfFormat">
                                        PDF
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="format" id="quantitiesExcelFormat" value="excel">
                                    <label class="form-check-label" for="quantitiesExcelFormat">
                                        Excel
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-file-download"></i> Generate Report
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-md-6 mb-4">
            <div class="card h-100">
                <div class="card-header">
                    <h3>Progress Report</h3>
                </div>
                <div class="card-body">
                    <p>Generate a report showing progress percentages for projects, sub jobs, or work items.</p>
                    
                    <form action="{{ url_for('main.generate_progress_report') }}" method="GET" target="_blank">
                        <div class="mb-3">
                            <label class="form-label">Project</label>
                            <select class="form-select" name="project_id" id="progressProjectSelect" required>
                                <option value="">Select Project</option>
                                {% for project in projects %}
                                    <option value="{{ project.id }}">{{ project.project_id_str }}: {{ project.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Sub Job</label>
                            <select class="form-select" name="sub_job_id" id="progressSubJobSelect" disabled>
                                <option value="">All Sub Jobs</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Report Level</label>
                            <select class="form-select" name="level" required>
                                <option value="project">Project Level</option>
                                <option value="sub_job">Sub Job Level</option>
                                <option value="work_item">Work Item Level</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Format</label>
                            <div class="d-flex">
                                <div class="form-check me-4">
                                    <input class="form-check-input" type="radio" name="format" id="progressPdfFormat" value="pdf" checked>
                                    <label class="form-check-label" for="progressPdfFormat">
                                        PDF
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="format" id="progressExcelFormat" value="excel">
                                    <label class="form-check-label" for="progressExcelFormat">
                                        Excel
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-file-download"></i> Generate Report
                        </button>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="col-md-6 mb-4">
            <div class="card h-100">
                <div class="card-header">
                    <h3>Rules of Credit Report</h3>
                </div>
                <div class="card-body">
                    <p>Generate a report showing Rules of Credit steps and progress for work items.</p>
                    
                    <form action="{{ url_for('main.generate_rules_report') }}" method="GET" target="_blank">
                        <div class="mb-3">
                            <label class="form-label">Project</label>
                            <select class="form-select" name="project_id" id="rulesProjectSelect" required>
                                <option value="">Select Project</option>
                                {% for project in projects %}
                                    <option value="{{ project.id }}">{{ project.project_id_str }}: {{ project.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Sub Job</label>
                            <select class="form-select" name="sub_job_id" id="rulesSubJobSelect" disabled>
                                <option value="">All Sub Jobs</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Format</label>
                            <div class="d-flex">
                                <div class="form-check me-4">
                                    <input class="form-check-input" type="radio" name="format" id="rulesPdfFormat" value="pdf" checked>
                                    <label class="form-check-label" for="rulesPdfFormat">
                                        PDF
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="format" id="rulesExcelFormat" value="excel">
                                    <label class="form-check-label" for="rulesExcelFormat">
                                        Excel
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-file-download"></i> Generate Report
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
<script>
    // Project and Sub Job selection for Hours Report
    document.getElementById('hoursProjectSelect').addEventListener('change', function() {
        const projectId = this.value;
        const subJobSelect = document.getElementById('hoursSubJobSelect');
        
        // Clear current options
        while (subJobSelect.options.length > 1) {
            subJobSelect.remove(1);
        }
        
        if (!projectId) {
            subJobSelect.disabled = true;
            return;
        }
        
        // Fetch sub jobs for selected project
        fetch(`/api/project/${projectId}/sub_jobs`)
            .then(response => response.json())
            .then(data => {
                subJobSelect.disabled = false;
                
                data.forEach(subJob => {
                    const option = document.createElement('option');
                    option.value = subJob.id;
                    option.textContent = `${subJob.sub_job_id_str}: ${subJob.name}`;
                    subJobSelect.appendChild(option);
                });
            })
            .catch(error => console.error('Error fetching sub jobs:', error));
    });
    
    // Project and Sub Job selection for Quantities Report
    document.getElementById('quantitiesProjectSelect').addEventListener('change', function() {
        const projectId = this.value;
        const subJobSelect = document.getElementById('quantitiesSubJobSelect');
        
        // Clear current options
        while (subJobSelect.options.length > 1) {
            subJobSelect.remove(1);
        }
        
        if (!projectId) {
            subJobSelect.disabled = true;
            return;
        }
        
        // Fetch sub jobs for selected project
        fetch(`/api/project/${projectId}/sub_jobs`)
            .then(response => response.json())
            .then(data => {
                subJobSelect.disabled = false;
                
                data.forEach(subJob => {
                    const option = document.createElement('option');
                    option.value = subJob.id;
                    option.textContent = `${subJob.sub_job_id_str}: ${subJob.name}`;
                    subJobSelect.appendChild(option);
                });
            })
            .catch(error => console.error('Error fetching sub jobs:', error));
    });
    
    // Project and Sub Job selection for Progress Report
    document.getElementById('progressProjectSelect').addEventListener('change', function() {
        const projectId = this.value;
        const subJobSelect = document.getElementById('progressSubJobSelect');
        
        // Clear current options
        while (subJobSelect.options.length > 1) {
            subJobSelect.remove(1);
        }
        
        if (!projectId) {
            subJobSelect.disabled = true;
            return;
        }
        
        // Fetch sub jobs for selected project
        fetch(`/api/project/${projectId}/sub_jobs`)
            .then(response => response.json())
            .then(data => {
                subJobSelect.disabled = false;
                
                data.forEach(subJob => {
                    const option = document.createElement('option');
                    option.value = subJob.id;
                    option.textContent = `${subJob.sub_job_id_str}: ${subJob.name}`;
                    subJobSelect.appendChild(option);
                });
            })
            .catch(error => console.error('Error fetching sub jobs:', error));
    });
    
    // Project and Sub Job selection for Rules Report
    document.getElementById('rulesProjectSelect').addEventListener('change', function() {
        const projectId = this.value;
        const subJobSelect = document.getElementById('rulesSubJobSelect');
        
        // Clear current options
        while (subJobSelect.options.length > 1) {
            subJobSelect.remove(1);
        }
        
        if (!projectId) {
            subJobSelect.disabled = true;
            return;
        }
        
        // Fetch sub jobs for selected project
        fetch(`/api/project/${projectId}/sub_jobs`)
            .then(response => response.json())
            .then(data => {
                subJobSelect.disabled = false;
                
                data.forEach(subJob => {
                    const option = document.createElement('option');
                    option.value = subJob.id;
                    option.textContent = `${subJob.sub_job_id_str}: ${subJob.name}`;
                    subJobSelect.appendChild(option);
                });
            })
            .catch(error => console.error('Error fetching sub jobs:', error));
    });
</script>
{% endblock %}
