<!DOCTYPE html>
<html>
<head>
    <title>{{ project.name }} - Hours Report</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
        th, td { border: 1px solid #000; padding: 4px; text-align: center; font-size: 8pt; vertical-align: middle; word-wrap: break-word; }
        th { background-color: #f2f2f2; font-weight: bold; }
        .header-container { display: flex; border: 2px solid #000; margin-bottom: 10px; }
        .header-left { flex: 1; padding: 5px; display: flex; align-items: center; }
        .header-center { flex: 2; padding: 5px; text-align: center; border-left: 2px solid #000; border-right: 2px solid #000; }
        .header-right { flex: 1; padding: 5px; text-align: right; }
        .logo { height: 50px; margin-right: 10px; }
        .project-info { text-align: center; margin-top: 5px; }
        .project-title { font-size: 12pt; font-weight: bold; margin: 0; }
        .project-id { font-size: 10pt; margin: 3px 0; }
        .report-title { font-size: 14pt; font-weight: bold; margin: 0; }
        .report-subtitle { font-size: 12pt; margin: 3px 0; }
        .page-info { font-size: 9pt; margin: 3px 0; }
        .discipline-header { background-color: #d9d9d9; font-weight: bold; text-align: left; padding-left: 5px; }
        .cost-code-main-header { background-color: #e6e6e6; font-weight: bold; text-align: left; padding-left: 5px; }
        .cost-code-roc-header { background-color: #e6e6e6; font-weight: bold; text-align: center; font-size: 6pt; }
        .subtotal-row { background-color: #e6f2ff; font-weight: bold; }
        .total-row { background-color: #cce5ff; font-weight: bold; }
        .numeric { text-align: right; }
        .roc-data-cell { text-align: right; font-size: 6pt;}
        .roc-main-header-row th { background-color: #f2f2f2; font-weight: bold; text-align: center; }
        .work-item-description {text-align: left; padding-left: 5px;}
        .work-item-id { width: 10%; }
        .description-col { width: 20%; }
        .numeric-col { width: 8%; }
        .roc-col { width: 7%; }
    </style>
</head>
<body>
    <div class="header-container">
        <div class="header-left">
            <img src="data:image/png;base64,{{ logo_base64 }}" class="logo" alt="Logo">
        </div>
        <div class="header-center">
            <p class="report-title">PROGRESS DETAIL</p>
            <p class="report-subtitle">{% if sub_job %}Sub Job by Hours{% else %}Total Project by Hours{% endif %}</p>
            <div class="project-info">
                <p class="project-title">{{ project.name }}</p>
                <p class="project-id">{{ project.project_id_str }}</p>
            </div>
        </div>
        <div class="header-right"><p class="page-info">Page @page of @topage</p><p class="page-info">Progress Thru:</p><p class="page-info">{{ report_date }}</p></div>
    </div>
    {% if sub_job %}<h3>{{ sub_job.sub_job_id_str }} - {{ sub_job.name }}</h3>{% endif %}
    <table>
        <thead>
            <tr class="roc-main-header-row">
                <th class="work-item-id">Work Item</th>
                <th class="description-col">Description</th>
                <th class="numeric-col">Budgeted Hours</th>
                <th class="numeric-col">Earned Hours</th>
                <th class="numeric-col">% Complete</th>
                <th colspan="7">Rules of Credit Steps</th>
            </tr>
        </thead>
        <tbody>
            {% for discipline, discipline_data in grouped_work_items.items() %}
                <tr><td colspan="12" class="discipline-header">{{ discipline }}</td></tr>
                {% for cost_code, cost_code_data in discipline_data.cost_codes.items() %}
                    <tr>
                        <td class="cost-code-main-header" colspan="1">{{ cost_code }}</td>
                        <td class="cost-code-main-header" colspan="4">&nbsp;</td> {# Empty cells for Desc, Budgeted, Earned, % Comp on CC row #}
                        {% for step_header_name in cost_code_data.roc_step_headers %}
                        <th class="cost-code-roc-header roc-col">{{ step_header_name }}</th>
                        {% endfor %}
                    </tr>
                    {% for work_item in cost_code_data.work_items %}
                        <tr>
                            <td class="work-item-id">{{ work_item.work_item_id_str }}</td>
                            <td class="work-item-description description-col">{{ work_item.description }}</td>
                            <td class="numeric numeric-col">{{ "%.2f"|format(work_item.budgeted_man_hours or 0) }}</td>
                            <td class="numeric numeric-col">{{ "%.2f"|format(work_item.earned_man_hours or 0) }}</td>
                            <td class="numeric numeric-col">{{ "%.1f%%"|format(work_item.percent_complete_hours or 0) }}</td>
                            {% for step_name_key in cost_code_data.roc_step_headers %}
                            <td class="roc-data-cell roc-col">
                                {% if step_name_key and step_name_key in work_item.roc_steps_progress %}
                                {{ "%.1f%%"|format(work_item.roc_steps_progress[step_name_key] or 0) }}
                                {% elif step_name_key %}
                                0.0%
                                {% else %}
                                &nbsp;
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>
                    {% endfor %}
                    <tr class="subtotal-row">
                        <td colspan="2">Cost Code Subtotal</td>
                        <td class="numeric">{{ "%.2f"|format(cost_code_data.subtotals.budgeted_hours) }}</td>
                        <td class="numeric">{{ "%.2f"|format(cost_code_data.subtotals.earned_hours) }}</td>
                        <td class="numeric">{{ "%.1f%%"|format(cost_code_data.subtotals.percent_complete_hours) }}</td>
                        <td colspan="7">&nbsp;</td>
                    </tr>
                {% endfor %}
                <tr class="subtotal-row">
                    <td colspan="2">Discipline Subtotal</td>
                    <td class="numeric">{{ "%.2f"|format(discipline_data.subtotals.budgeted_hours) }}</td>
                    <td class="numeric">{{ "%.2f"|format(discipline_data.subtotals.earned_hours) }}</td>
                    <td class="numeric">{{ "%.1f%%"|format(discipline_data.subtotals.percent_complete_hours) }}</td>
                    <td colspan="7">&nbsp;</td>
                </tr>
            {% endfor %}
            <tr class="total-row">
                <td colspan="2">Total</td>
                <td class="numeric">{{ "%.2f"|format(project_totals.budgeted_hours) }}</td>
                <td class="numeric">{{ "%.2f"|format(project_totals.earned_hours) }}</td>
                <td class="numeric">{{ "%.1f%%"|format(project_totals.percent_complete_hours) }}</td>
                <td colspan="7">&nbsp;</td>
            </tr>
        </tbody>
    </table>
</body>
</html>
